{% extends "accounts/base_owner.html" %}
{% block title %}ğŸ“¦ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø©{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 py-8 space-y-10">

  <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­Ø¯Ø© ÙˆØ²Ø± ØªØ¹Ø¯ÙŠÙ„ / Ø­Ø°Ù -->
  <div class="flex justify-between items-center border-b pb-4">
    <div>
      <h1 class="text-2xl font-bold text-green-700">ğŸ“¦ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø© {{ unit.unit_number }}</h1>
      <p class="text-sm text-gray-500">Ø§Ù„Ø¹Ù‚Ø§Ø±: {{ unit.property.name }} - {{ unit.property.city }}/{{ unit.property.district }}</p>
    </div>
    <div class="flex gap-2">
      <a href="{% url 'management:edit_unit' unit.pk %}"
         class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 text-sm rounded shadow">
        âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø©
      </a>
      <form action="{% url 'management:delete_unit' unit.pk %}" method="post" onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙˆØ­Ø¯Ø©ØŸ');">
        {% csrf_token %}
        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 text-sm rounded shadow">
          ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙˆØ­Ø¯Ø©
        </button>
      </form>
    </div>
  </div>

  <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø© -->
  <div class="bg-white border rounded-xl shadow p-6 space-y-4 text-sm text-gray-700">
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <p><strong>ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©:</strong> {{ unit.unit_number }}</p>
      <p><strong>ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</strong> {{ unit.area }} Ù…Â²</p>
      <p><strong>ğŸ’° Ø§Ù„Ø³Ø¹Ø±:</strong> {{ unit.price }} Ø±ÙŠØ§Ù„</p>
      {% if unit.location %}<p><strong>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> {{ unit.location }}</p>{% endif %}
      <p><strong>ğŸ“Œ Ø§Ù„Ø­Ø§Ù„Ø©:</strong> {{ unit.get_status_display }}</p>
      {% if unit.assigned_to %}<p><strong>ğŸ‘¤ Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</strong> {{ unit.assigned_to.get_full_name }}</p>{% endif %}
      {% if unit.notes %}<p class="sm:col-span-2"><strong>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> {{ unit.notes }}</p>{% endif %}
      <p><strong>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</strong> {{ unit.created_at|date:"Y-m-d" }}</p>
    </div>
  </div>

  <!-- Ø¹Ù‚Ø¯ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± -->
  <div class="bg-white border rounded-xl shadow p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-bold text-green-600">ğŸ“„ Ø¹Ù‚Ø¯ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±</h2>
      {% if rental_info %}
        <div class="flex gap-3">
          <a href="{% url 'management:edit_rental_info' unit.id %}" class="text-blue-600 hover:underline text-sm">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a>
          <form method="post" action="{% url 'management:delete_rental_info' unit.id %}" onsubmit="return confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¹Ù‚Ø¯ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ØŸ');">
            {% csrf_token %}
            <button type="submit" class="text-red-600 hover:underline text-sm">ğŸ—‘ï¸ Ø­Ø°Ù</button>
          </form>
        </div>
      {% else %}
        <a href="{% url 'management:add_rental_info' unit.pk %}" class="text-sm text-green-700 hover:underline">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø¯</a>
      {% endif %}
    </div>
    {% if rental_info %}
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-gray-700">
        <p><strong>ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±:</strong> {{ rental_info.tenant_name }}</p>
        <p><strong>ğŸ’µ Ù…Ø¨Ù„Øº Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±:</strong> {{ rental_info.amount }} Ø±ÙŠØ§Ù„</p>
        <p><strong>ğŸ—“ï¸ Ù…Ù†:</strong> {{ rental_info.start_date }}</p>
        <p><strong>ğŸ—“ï¸ Ø¥Ù„Ù‰:</strong> {{ rental_info.end_date }}</p>
      </div>
    {% else %}
      <p class="text-sm text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù‚Ø¯ Ø¥ÙŠØ¬Ø§Ø± Ù…Ø³Ø¬Ù„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ­Ø¯Ø©.</p>
    {% endif %}
  </div>

  <!-- Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
  <div class="bg-white border rounded-xl shadow p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-bold text-green-600">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª / Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h2>
      <a href="{% url 'management:add_unit_update' unit.pk %}" class="text-sm text-green-700 hover:underline">â• ØªØ³Ø¬ÙŠÙ„ Ù…ØµØ±ÙˆÙ</a>
    </div>
    {% if updates %}
      <ul class="divide-y divide-gray-200 text-sm text-gray-700">
        {% for update in updates %}
          <li class="py-3 flex flex-col sm:flex-row sm:justify-between sm:items-center">
            <div>
              <strong>{{ update.update_type }}</strong>
              <span class="text-gray-500">- {{ update.date }}</span>
            </div>
            <div class="flex gap-3 mt-1 sm:mt-0">
              {% if update.amount %}
                <span class="text-red-600 font-bold">{{ update.amount }} Ø±ÙŠØ§Ù„</span>
              {% endif %}
              {% if update.attachment %}
                <a href="{{ update.attachment.url }}" target="_blank" class="text-blue-600 hover:underline">ğŸ“ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø±ÙÙ‚</a>
              {% endif %}
              <a href="{% url 'management:edit_unit_update' update.pk %}" class="text-blue-600 text-sm hover:underline">âœï¸</a>
              <form method="post" action="{% url 'management:delete_unit_update' update.pk %}" class="inline-block"
                    onsubmit="return confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ');">
                {% csrf_token %}
                <button type="submit" class="text-red-600 text-sm hover:underline bg-transparent border-0">ğŸ—‘ï¸</button>
              </form>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-sm text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø£Ùˆ Ù…ØµØ±ÙˆÙØ§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ­Ø¯Ø©.</p>
    {% endif %}
  </div>

  <!-- Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© -->
  <div class="bg-white border rounded-xl shadow p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-bold text-green-600">ğŸ› ï¸ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø©</h2>
      {% if user.is_staff %}
        <a href="{% url 'management:schedule_maintenance' unit.pk %}" class="text-sm text-green-700 hover:underline">â• ØªØ³Ø¬ÙŠÙ„ ØµÙŠØ§Ù†Ø©</a>
      {% endif %}
    </div>
    {% if scheduled_maintenances %}
      <ul class="divide-y divide-gray-200 text-sm text-gray-700">
        {% for maintenance in scheduled_maintenances %}
          <li class="py-3 flex flex-col sm:flex-row sm:justify-between sm:items-center">
            <div>
              <strong>{{ maintenance.description }}</strong>
              <span class="text-gray-500">- {{ maintenance.date }}</span>
            </div>
            {% if user.is_staff %}
              <div class="flex gap-3 mt-1 sm:mt-0">
                <a href="{% url 'management:edit_scheduled_maintenance' maintenance.pk %}" class="text-blue-600 text-sm hover:underline">âœï¸</a>
                <form method="post" action="{% url 'management:delete_scheduled_maintenance' maintenance.pk %}" class="inline-block"
                      onsubmit="return confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙŠØ§Ù†Ø©ØŸ');">
                  {% csrf_token %}
                  <button type="submit" class="text-red-600 text-sm hover:underline bg-transparent border-0">ğŸ—‘ï¸</button>
                </form>
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-sm text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙŠØ§Ù†Ø§Øª Ù…Ø¬Ø¯ÙˆÙ„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
    {% endif %}
  </div>

</div>
{% endblock %}
